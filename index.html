<!DOCTYPE html>
<html>
<head>
  <title>Spatial Recall Verification</title>

  <!-- Load libraries -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>

  <!-- Proliferate library and jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://proliferate.alps.science/static/js/proliferate.js" type="text/javascript"></script>

  <!-- Initialize jsPsych -->
  <script src="./js/init-jspsych.js"></script>

  <!-- Load jsPsych plug-ins -->
  <script src="./js/plugin-spatial-recall.js"></script>
  <script src="./js/plugin-screen-check.js"></script>
  <script src="./js/plugin-dsst-with-end-rest.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-animation@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-external-html@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.3"></script>

  <!-- Load experiment -->
  <script src="./js/spatial-recall.js" type="text/javascript"></script>
  <script src="./js/instructions.js"></script>
  <script src="./js/rest-experiment.js"></script>

  <link rel="stylesheet" href="./js/style.css">
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />

  <!-- Load CSS styles -->
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">


</head>
<body></body>
<script>

  var fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true,
  };
  
  
  // MAIN EXPERIMENT SET UP VARIABLES
  // num_epochs is defined in rest-experiment.js
  
  // preload external html file and images for rest task
  var preload = {
    type: jsPsychPreload,
    message: 'Loading images. This may take a moment depending on your internet connection.',
    error_message: '<p>The experiment failed to load. Please try restarting your browser.</p><p>If this error persists after 2-3 tries, please contact the experimenter.</p>',
    continue_after_error: false,
    show_progress_bar: true,
    max_load_time: 30000,
    images: ['./img/Circle.png','./img/Square.png']
  };
  
  // consent form
  var consent_form = {
    type: jsPsychExternalHtml,
    url: "js/poldrack_consent_form.html",
    cont_btn: "start",
    on_finish: function(data){
      data.task_type = "spatial_recall_only"
    }
  };
  
  // INITIALIZE TIMELINE
  var timeline = [];
  
  // INSTRUCTIONS AND PRACTICE SESSION
  timeline.push(preload, fullscreen, consent_form, prolific_id_insert, welcome_practice_instructions)
  
  // Practice: spatial recall practice, then rest practice
  timeline.push(sr_practice_instructions, sr_recall_forwards_practice, rest_practice_instructions, rt_practice, main_exp_instructions)
  
  // MAIN EXPERIMENT: Create epochs with rest blocks between them
  // Each epoch is: spatial recall epoch, then rest block
  var sr_epoch_trials = {
    timeline: sr_getBlock()
  }
  
  // Build the main experiment timeline: epoch 1, rest, epoch 2, rest, ..., epoch N
  for (var epoch_num = 1; epoch_num <= num_epochs; epoch_num++) {
    timeline.push(sr_epoch_trials);
    
    // Add rest block after each epoch (except after the last one)
    if (epoch_num < num_epochs) {
      timeline.push(createSelfPacedRestTimeline(epoch_num, "epoch_rest"));
    }
  }
    
  var overall_debrief = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function() {
      var current_bonus = getPropRestUsed(bonus_minimum, dependent_bonus); // calculate right here
      return `
        <div class="instructions-container">
          <h1 class="instructions-heading">Thank You!</h1>
          <p class="instructions-text">
            Thanks for participating! This experiment sought to understand cognitive fatigue and effort. Your final completion bonus is
            <strong>${current_bonus}</strong> dollars. The experiment is over now, press any button to continue to be redirected.
          </p>
        </div>
      `;
    },
    on_finish: function(data) {
      data.final_bonus = getPropRestUsed(bonus_minimum, dependent_bonus); // Store in data as well
    }
  };
  
  // CONCLUSION AND DEBRIEFS
  var rest_debrief = {
    type: jsPsychSurveyText,
    preamble: `<p>Great work! We will now do a short debrief. <br><br> In this experiment you were asked to end the rest whenever you wanted.</p>`,
    questions: [
      {prompt: 'How did you decide when to end the rest trials? Did your strategy change over time?', rows: 3,name: 'rest_decision'},
      {prompt: 'What did you think about or do during the rest trials?', rows: 3,name: 'rest_strategy'},
      {prompt: 'Were you trying to conserve endowment points?', rows: 3,name: 'rest_conserve'},
      {prompt: 'Do you have any other feedback or comments?', rows: 3,name: 'gen_feedback'},
    ]
  }
  
  var task_debrief = {
    type: jsPsychSurveyText,
    preamble: `<p>In this experiment you played the spatial recall game.</p>`,
    questions: [
      {prompt: 'On a scale of 1 to 100, how <strong>boring</strong> did you find the <strong>spatial recall</strong> game? 100 is very boring, 1 is not boring at all.',name: 'sr_boring'},
      {prompt: 'On a scale of 1 to 100, how <strong>boring</strong> did you find the <strong>rest</strong> game? 100 is very boring, 1 is not boring at all.',name: 'rt_boring'},
      {prompt: 'On a scale of 1 to 100, how <strong>difficult</strong> did you find the <strong>spatial recall</strong> game? 100 is very difficult, 1 is not difficult at all.',name: 'sr_difficult'},
      {prompt: 'On a scale of 1 to 100, how <strong>difficult</strong> did you find the <strong>rest</strong> game? 100 is very difficult, 1 is not difficult at all.',name: 'rt_difficult'},
    ]
  }
  
  timeline.push(rest_leftovers_transition, rt_leftovers, rest_debrief, task_debrief, overall_debrief, exitFullscreen)
  
  // RUN THE EXPERIMENT
  jsPsych.run(timeline);
</script>
</html>

